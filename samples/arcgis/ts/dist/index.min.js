!function(){let t,e,o,n="<Enter your Azure Speech subscription key here>",i="<Enter Azure's subscription region>",a="en-US",r=null,d={lat:58.967774948,lon:11.196062412},s=13,c="ws://<STP server>:<STP port>";function l(t,e="Info",o=!1){o&&alert(t);const n=document.getElementById("messages");if(!n)throw new Error("Html page must contain a 'messages' div");n.innerHTML=t,n.style.color="Error"===e?"red":"black"}window.onload=()=>async function(){const g=new URLSearchParams(window.location.search),p=g.get("lat"),S=g.get("lon");p&&S&&(d={lat:parseFloat(p),lon:parseFloat(S)});const m=g.get("zoom");m&&(s=parseInt(m));const u=g.get("azkey");u&&(n=u);const f=g.get("azregion");f&&(i=f);const y=g.get("azlang");y&&(a=y);const h=g.get("azendp");h&&(r=h);const I=g.get("inkonly"),T=g.get("machineid")??void 0,k=g.get("stpurl");k&&(c=k);const E=g.get("mapkey")??null,w=g.get("mil2525StyleUrl")??g.get("milstyleurl")??g.get("milstylurl")??window.MIL2525_STYLE_URL??void 0,v=g.get("mil2525PortalItemId")??g.get("milstyle")??window.MIL2525_PORTAL_ITEM_ID??void 0,b="SdkC2SIMArcGIS",R=new StpSDK.StpWebSocketsConnector(c);t=new StpSDK.StpRecognizer(R),t.onSymbolAdded=(t,o)=>{try{const o=t[0].asGeoJSON();e.addFeature(o)}catch(t){l(t.message,"Warning")}},t.onSymbolModified=(t,o,n)=>{try{e.removeFeature(t);const n=o.asGeoJSON();e.addFeature(n)}catch(t){l(t.message,"Warning")}},t.onSymbolDeleted=(t,o)=>{e.removeFeature(t)};const P=document.getElementById("roles");t.onRoleSwitched=t=>{try{t?(P.value=t,l("Role switched to: "+t,"Info")):(l("Role was reset","Info"),P.value="none")}catch(t){l(t.message,"Warning")}},t.onTaskOrgAdded=t=>{l("Task Org added: "+t.name,"Info")},t.onTaskOrgModified=(t,e)=>{l("Task Org modified: "+t+" "+e.name,"Info")},t.onTaskOrgDeleted=t=>{l("Task Org deleted: "+t,"Info")},t.onTaskOrgUnitAdded=t=>{l("Task Org Unit added: "+t.fullDescription,"Info")},t.onTaskOrgUnitModified=(t,e)=>{l("Task Org Unit modified: "+t+" "+e.fullDescription,"Info")},t.onTaskOrgUnitDeleted=t=>{l("Task Org Unit deleted: "+t,"Info")},t.onTaskOrgRelationshipAdded=t=>{l("Task Org Relationship added: "+t.poid,"Info")},t.onTaskOrgRelationshipModified=t=>{l("Task Org Relationship modified: "+t,"Info")},t.onTaskOrgRelationshipDeleted=t=>{l("Task Org Relationship deleted: "+t,"Info")},t.onTaskOrgSwitched=t=>{try{const e=document.getElementById("toName");e.innerText=t?.name??"none",o=t?.poid,e.style.color="friend"==t?.affiliation?"blue":"hostile"==t?.affiliation?"red":"gray",l("Task Org switched to: "+t?.poid,"Info")}catch(t){l(t.message,"Warning")}},t.onTaskAdded=(t,e)=>{l("Task added: "+e[0].description,"Info")},t.onTaskModified=(t,e)=>{l("Task modified: "+t+" "+e[0].description,"Info")},t.onTaskDeleted=t=>{l("Task removed: "+t,"Info")},t.onSymbolEdited=(t,e)=>{l("Symbol edit operation: "+t+" gesture:"+e.shape,"Info")},t.onMapOperation=(t,e)=>{l("Map operation: "+t+" gesture:"+e.shape,"Info")},t.onCommand=(t,o)=>{l("Command: "+t+" gesture:"+o.shape,"Info"),e.addPoly(o.coords)},t.onInkProcessed=()=>{e.clearInk()},t.onSpeechRecognized=t=>{l(t&&t.length>0?t[0]:"")},t.onStpMessage=(t,e)=>{l(t,e,!0)};document.getElementById("new").onclick=async()=>{try{await t.createNewScenario(b),l("New scenario created")}catch(t){l(String(t),"Error")}};document.getElementById("join").onclick=async()=>{try{await t.hasActiveScenario()?(await t.joinScenarioSession(),l("Joined scenario")):l("No Active Scenario")}catch(t){l(String(t),"Error")}};let A="";document.getElementById("save").onclick=async()=>{try{await t.hasActiveScenario()?(A=await t.getScenarioContent(),l("Saved scenario")):l("No Active Scenario")}catch(t){l(String(t),"Error")}};document.getElementById("load").onclick=async()=>{try{""!==A?(await t.loadNewScenario(A,90),l("Loaded previously Saved scenario data")):l("No scenario data to load - Save first")}catch(t){l(String(t),"Error")}};document.getElementById("sync").onclick=async()=>{try{""!==A?(await t.syncScenarioSession(A,90),l("Synched (predefined) scenario with session")):l("No scenario data to sync - Save first")}catch(t){l(String(t),"Error")}};document.getElementById("getto").onclick=async()=>{try{if(o){await t.getTaskOrgContent(o);l("Retrieved content of latest TO (id "+o+") ready to save")}else l("Nothing to retrieve. Load a TO first")}catch(t){l(String(t),"Error")}};let D;document.getElementById("friend").onclick=async()=>{try{if(void 0===D){const e="object_set([\n                    [fsTYPE: task_org, name: '2-69 short', affiliation: friend, poid: idR47DS5VCGL9ZE, date: '2023-05-22T13:40:00Z'],\n                    [fsTYPE: task_org_unit, name: 'ALPHA TWO SIX NINE', designator1: 'A', unit_parent: '2-69', symbol_id: 'SFGPUCIZ---E---', parent_poid: poid(idR47DS5VCGL9ZE), affiliation: friend, echelon: company, poid: 'uuid7e99345a-f15a-4939-b963-0b83b1ec40f0'],\n                    [fsTYPE: task_org_unit, name: '(ONE | FIRST) [ROYAL] IRISH [GUARDS]', designator1: '1', unit_parent: 'A/2-69', symbol_id: 'SFGPUCIZ---D---', parent_poid: poid(idR47DS5VCGL9ZE), affiliation: friend, echelon: platoon, poid: 'uuid5336c5d5-9182-4846-bdd8-5c517869c274'],\n                    [fsTYPE: task_org_relationship, poid: idPNPMCKGE2TPLF, affiliation: friend, parent: poid(uuid7e99345a-f15a-4939-b963-0b83b1ec40f0), relationship: organic, child: poid(uuid5336c5d5-9182-4846-bdd8-5c517869c274), parent_poid: poid(idR47DS5VCGL9ZE)],\n                ])";D=await t.importTaskOrgContent(e)}await t.setDefaultTaskOrg(D),l("Friendly TO "+D+" set as default")}catch(t){l(String(t),"Error")}};let O;document.getElementById("hostile").onclick=async()=>{try{if(void 0===O){const e="object_set([\n                    [fsTYPE: task_org, name: 'Hostile 1-1', affiliation: hostile, poid: idR47DS5VCGL8AB, date: '2023-05-22T13:40:00Z'],\n                    [fsTYPE: task_org_unit, name: 'B/1-1_INF', designator1: 'B', unit_parent: '1-1', symbol_id: 'SHGPUCIZ---E---', parent_poid: poid(idR47DS5VCGL8AB), affiliation: hostile, echelon: company, poid: uuid7e99345a-f15a-4939-b963-0b83b1ec51a2],\n                    [fsTYPE: task_org_unit, name: '1/B/1-1_INF', designator1: '1', unit_parent: 'B/1-1', symbol_id: 'SHGPUCIZ---D---', parent_poid: poid(idR47DS5VCGL8AB), affiliation: hostile, echelon: platoon, poid: uuid5336c5d5-9182-4846-bdd8-5c517869d342],\n                    [fsTYPE: task_org_relationship, poid: idPNPMCKGE5TRTF, affiliation: hostile, parent: poid(uuid7e99345a-f15a-4939-b963-0b83b1ec51a2), relationship: organic, child: poid(uuid5336c5d5-9182-4846-bdd8-5c517869d342), parent_poid: poid(idR47DS5VCGL8AB)],\n                    ])";O=await t.importTaskOrgContent(e)}await t.setDefaultTaskOrg(O),l("Hostile TO "+O+" set as default")}catch(t){l(String(t),"Error")}};let _;P.onchange=async()=>{try{_=P.value,P.value="none",l("Requesting role switch to "+_);const e={s2:StpSDK.StpRole.s2,s3:StpSDK.StpRole.s3,s4:StpSDK.StpRole.s4,fso:StpSDK.StpRole.fso,eng:StpSDK.StpRole.eng};_&&e[_]&&await t.setCurrentRole(e[_])}catch(t){l(String(t),"Error")}};const C=new StpSDK.StpC2SIMOptions;C.serverProtocol="1.0.2";const B=t.createC2SIMProxy(C),M=document.getElementById("export"),z=document.getElementById("affiliation"),N=document.getElementById("types");M.onclick=async()=>{try{if(await t.hasActiveScenario()){l("Exporting "+N.value+"...");const t="Initialization"===N.value?"initialization":"order",e="friend"===z.value?"friend":"hostile"===z.value?"hostile":"all";await B.exportPlanDataToC2SIMServer("C2SIMSample",t,e),l(N.value+" exported to C2SIM")}else l("No Active Scenario to export")}catch(t){l(String(t),"Error")}};document.getElementById("import").onclick=async()=>{try{await t.hasActiveScenario()||(await t.createNewScenario(b),l("New scenario created")),l("Importing C2SIM Initialization..."),await B.importInitializationFromC2SIMServer(),l("Initialization imported from C2SIM into the current scenario")}catch(t){l(String(t),"Error")}},B.onSymbolReport=(t,o)=>{e.removeFeature(t);try{const t=o.asGeoJSON();e.addFeature(t)}catch(t){l(t.message,"Warning")}};let F;document.getElementById("connect").onclick=async()=>{try{const o=document.getElementById("sessionId"),n=o.value;o.value=await t.connect(b,30,T??void 0,n)??"",async function(o){e.load(),await t.hasActiveScenario()?l("STP session has active scenario - Join or Sync to display content"):(l("STP session has no active scenario - creating new"),await t.createNewScenario(o),l("New scenario created"))}(b)}catch(t){return void l("Failed to connect to STP at "+c+". \nSymbols will not be recognized. Please reload to try again","Error",!0)}},null!=I?F=null:(F=new StpAS.AzureSpeechRecognizer(n,i,r,null,a),F.onRecognized=e=>{if(e&&e.results&&e.results.length>0){F.stopRecognizing(),t.sendSpeechRecognition(e.results,e.startTime,e.endTime);l(e.results.map(t=>t.text).join(" | "))}},F.onRecognizing=t=>{l(t)},F.onError=t=>{l("Failed to process speech: "+t.message)});e=new ArcGISMap(E,"map",d,s,{mil2525StyleUrl:w,mil2525PortalItemId:v}),e.onStrokeStart=(e,o)=>{t.sendPenDown(e,o),F&&(l("Speech: start recognizing","Info"),F.startRecognizing())},e.onStrokeCompleted=(e,o,n,i,a,r,d)=>{t.sendInk(e,o,n,i,a,r,d),F&&(l("Speech: stop recognizing (5s timeout)","Info"),F.stopRecognizing(5e3))},e.onSelection=o=>{const n=function(t){if(!t||!t.location||!t.location.centroid)return null;let e='<h3 id="firstHeading" class="firstHeading">'+(t.fullDescription??t.description??"Symbol")+"</h3><table><tr><td>2525D PartA</td><td>"+(t.sidc?.partA??"")+"</td></tr><tr><td>2525D PartB</td><td>"+(t.sidc?.partB??"")+"</td></tr><tr><td>Symbol Set</td><td>"+(t.sidc?.symbolSet??"")+"</td></tr><tr><td>2525C SIDC</td><td>"+(t.sidc?.legacy??"")+"</td></tr><tr><td>Affiliation</td><td>"+(t.affiliation??"")+"</td></tr>";"unit"==t.fsTYPE&&(e+="<tr><td>Echelon</td><td>"+(t.echelon??"")+"</td></tr>");e+="<tr><td>Parent Unit</td><td>"+(t.parent??"")+"</td></tr><tr><td>Designator 1</td><td>"+(t.designator1??"")+"</td></tr><tr><td>Designator 2</td><td>"+(t.designator2??"")+"</td></tr><tr><td>Status</td><td>"+(t.status??"")+"</td></tr>","unit"==t.fsTYPE&&(e+="<tr><td>Modifier</td><td>"+(t.modifier??"")+"</td></tr><tr><td>Strength</td><td>"+(t.strength??"")+"</td></tr><tr><td>Branch</td><td>"+(t.branch??"")+"</td></tr>");return e+="<tr><td>Time From</td><td>"+(t.timeFrom??"")+"</td></tr><tr><td>Time To</td><td>"+(t.timeTo??"")+"</td></tr><tr><td>Altitude</td><td>"+(t.altitude??"")+"</td></tr><tr><td>Min Altitude</td><td>"+(t.minAltitude??"")+"</td></tr><tr><td>Max Altitude</td><td>"+(t.maxAltitude??"")+'</td></tr><tr><td><button id="delButton">Delete</button></td></tr></table>',e}(o);n&&o&&o.poid&&o.location&&o.location.centroid&&e.displayInfo(n,o.location.centroid,[{selector:"#delButton",handler:()=>{t.deleteSymbol(o.poid)},closeInfo:!0}])}}(),window.onerror=(t,e,o,n)=>{try{if(!t&&0===o)return l("Unexpected Error: "+t+" url: "+e+" line: "+o+(n?"\ncolumn: "+n:""),"Error",!0),!0}catch(t){}}}();