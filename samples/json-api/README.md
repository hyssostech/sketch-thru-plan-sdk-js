# Sketch-thru-Plan JSON API

Sketch-thru-Plan (STP) provides a high-level JSON API based on [OpenRPC](https://github.com/open-rpc) that can be used to access services using languages for which an SDK may not be available.

## API access to/from STP

Events generated by client applications are normally forwarded to STP via Websockets. Other  mechanisms may be supported, in cases where STP is embedded in a larger server-side application that uses other communication mechanisms, for example event queues.

Sample code (in typescript) demonstrating how the standard STP Websockets connector is implemented can be found under [samples/typescript/connector-plugin](../typescript/connector-plugin).

Independently of the mechanism, communication with STP is required to be two-way, to provide ways for a client service to communicate events, such as user sketches and speech, but also receive events generated by other services, for example , events signaling that new symbols have been added.

## Outgoing message format

The JSON API mirrors the SDKs very closely. In fact, the SDKs offer a thin layer over the JSON API for convenience when using the services in javascript or .NET.

* method - Name of the event - same as used in the SDK
* params - Event parameters - same order and type as the SDK

```javascript
{
    "method":"SendPenDown",
    "params":{
        "location": {
            "lat":58.95657852665255,
            "lon":11.175978030896498},
        "timestamp":"2020-10-27T20:50:30.584Z"
    }
}
```

## Incoming message format

Incoming messages follow the same format as the outgoing ones, with a `method` property indicating the type, and `params` providing event-specific parameters. In the SDK, these corresponds to events the client subscribes to, prefixed with "on", for example `onSymbolAdded`. See the [javascript quickstart](../../quickstart/js/README.md) for examples.

```javascript
{
    "method":"SymbolAdded",
    "params":{
        "symbol":{
            "fsTYPE":"unit",
            "poid":"idDS6X03AGXT68E",
            "creatorRole":"s3",
            "confidence":0.820098781593131,
            "alt":0,
            "sidc":{
                "partA":"1003100015",
                "partB":"1205010000",
                "symbolSet":"10",
                "legacy":"SFGPUCRVA--E---"
            },
            "location":{
                "fsTYPE":"unit",
                "shape":"point",
                "coords":[{"lon":11.1648166167093,"lat":58.9486323288235}],
                "width":0.0,
                "altitude":0.0,
                "radius":0.0,
                "candidatePoids":[]
            },
            "shortDescription":"A/3-1",
            "description":"ARMORED CAVALRY RECON COMPANY",
            "fullDescription":"FRIENDLY ARMORED CAVALRY RECON COMPANY A/3-1",
            "affiliation":"friend",
            "echelon":"company",
            "parent":"3-1",
            "designator1":"A",
            "designator2":null,
            "status":"present",
            "modifier":"none",
            "strength":"none",
            "timeFrom":null,
            "timeTo":null,
            "altitude":null,
            "minAltitude":null,
            "maxAltitude":null
        },
        "isUndo":false
    }
}
```

## Schema

**UNDER CONSTRUCTION** The [OpenRPC](https://github.com/open-rpc) definition of the api can be found in [sketch-thru-plan-api.json](sketch-thru-plan-api.json)
