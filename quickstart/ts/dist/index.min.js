!function(t){function e(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var o=e(SpeechSDK);"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;function n(t,e,o){return t(o={path:e,exports:{},require:function(t,e){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==e&&o.path)}},o.exports),o.exports}var i=n((function(t,e){!function(t){function e(t,n){let i,s=t&&t.type;if("FeatureCollection"===s){let o=t;for(i=0;i<o.features.length;i++)e(o.features[i],n)}else if("GeometryCollection"===s){let o=t;for(i=0;i<o.geometries.length;i++)e(o.geometries[i],n)}else if("Feature"===s)e(t.geometry,n);else if("Polygon"===s)o(t.coordinates,n);else if("MultiPolygon"===s){let e=t;for(i=0;i<e.coordinates.length;i++)o(e.coordinates[i],n)}return t}function o(t,e){if(0!==t.length){n(t[0],e);for(let o=1;o<t.length;o++)n(t[o],!e)}}function n(t,e){let o=0;for(let e=0,n=t.length,i=n-1;e<n;i=e++)o+=(t[e][0]-t[i][0])*(t[i][1]+t[e][1]);o>=0!=!!e&&t.reverse()}var i;(i=t.StpMessageLevel||(t.StpMessageLevel={})).Error="Error",i.Warning="Warning",i.Info="Info",i.Debug="Debug";class s{}class r extends s{asGeoJSON(){var t,o,n,i,s,r;if(null==this.location||null==this.location.coords||0==(null===(t=this.location)||void 0===t?void 0:t.coords.length))throw new Error("Coordinates are undefined or empty");let l;if("point"===(null===(o=this.location)||void 0===o?void 0:o.fsTYPE))l={type:"Point",coordinates:[this.location.coords[0].lon,this.location.coords[0].lat]};else if("line"===(null===(n=this.location)||void 0===n?void 0:n.fsTYPE))l={type:"LineString",coordinates:this.location.coords.map((t=>[t.lon,t.lat]))};else if("area"===(null===(i=this.location)||void 0===i?void 0:i.fsTYPE))l={type:"Polygon",coordinates:[this.location.coords.map((t=>[t.lon,t.lat]))]},l=e(l,!1);else{if("multipoint"!==(null===(s=this.location)||void 0===s?void 0:s.fsTYPE))throw new Error('Expected "point", "line", "area", or "multipoint" geometry type. Got: '+(null===(r=this.location)||void 0===r?void 0:r.fsTYPE));l={type:"MultiPoint",coordinates:this.location.coords.map((t=>[t.lon,t.lat]))}}return{type:"Feature",id:this.poid,geometry:l,properties:{symbol:this}}}}var l=function(t,e,o,n){return new(o||(o=Promise))((function(i,s){function r(t){try{a(n.next(t))}catch(t){s(t)}}function l(t){try{a(n.throw(t))}catch(t){s(t)}}function a(t){var e;t.done?i(t.value):(e=t.value,e instanceof o?e:new o((function(t){t(e)}))).then(r,l)}a((n=n.apply(t,e||[])).next())}))},a=function(t,e,o,n){return new(o||(o=Promise))((function(i,s){function r(t){try{a(n.next(t))}catch(t){s(t)}}function l(t){try{a(n.throw(t))}catch(t){s(t)}}function a(t){var e;t.done?i(t.value):(e=t.value,e instanceof o?e:new o((function(t){t(e)}))).then(r,l)}a((n=n.apply(t,e||[])).next())}))};t.Interval=class{constructor(t,e){this.start=t,this.end=e}equals(t){return this.start==t.start&&this.end==t.end}},t.LatLon=class{constructor(t,e){this.lat=t,this.lon=e}equals(t){return this.lat==t.lat&&this.lon==t.lon}},t.Location=class{},t.Sidc=class{},t.Size=class{constructor(t,e){this.width=t,this.height=e}equals(t){return this.width==t.width&&this.height==t.height}},t.StpItem=s,t.StpRecognizer=class{constructor(t){this.stpConnector=t,this.serviceName=""}connect(t,e){return l(this,void 0,void 0,(function*(){this.serviceName=t,this.stpConnector.onInform=this.onInform.bind(this),this.stpConnector.onRequest=this.onRequest.bind(this),this.stpConnector.onError=this.onError.bind(this);try{let t=this.buildSolvables();return this.stpConnector.connect(this.serviceName,t,e)}catch(t){throw t}}))}buildSolvables(){return Object.getOwnPropertyNames(this).filter((t=>t.toString().startsWith("on")&&"function"==typeof this[t])).map((t=>t.substring(2)))}onInform(t){let e=JSON.parse(t);this.handleInform(e)}onRequest(t){return this.onInform(t),[]}onError(e){this.onStpMessage&&this.onStpMessage(e,t.StpMessageLevel.Error)}sendPenDown(t,e){return l(this,arguments,void 0,(function*(){this.informStp("SendPenDown",{location:arguments[0],timestamp:arguments[1]})}))}sendInk(t,e,o,n,i,s,r){this.informStp("SendInk",{pixelBoundsWindow:arguments[0],topLeftGeoMap:arguments[1],bottomRightGeoMap:arguments[2],strokePoints:arguments[3],timeStrokeStart:arguments[4],timeStrokeEnd:arguments[5],intersectedPoids:arguments[6]})}sendSpeechRecognition(t,e,o){this.informStp("SendSpeechRecognition",{recoList:arguments[0],startTime:arguments[1],endTime:arguments[2]})}addSymbol(t){this.informStp("AddSymbol",{symbol:arguments[0]})}updateSymbol(t,e){this.informStp("UpdateSymbol",{poid:arguments[0],symbol:arguments[1]})}deleteSymbol(t){this.informStp("DeleteSymbol",{poid:arguments[0]})}chooseAlternate(t,e){this.informStp("ChooseAlternate",{poid:arguments[0],nBestIndex:arguments[1]})}informStp(e,o){try{let t={method:e,params:o};this.stpConnector.inform(JSON.stringify(t))}catch(e){this.onStpMessage&&this.onStpMessage(e.message,t.StpMessageLevel.Error)}}handleInform(t){if("SymbolAdded"===t.method&&this.onSymbolAdded){const e=t.params;let o=[];for(let t=0;t<e.alternates.length;t++){const n=Object.assign(new r,e.alternates[t]);o.push(n)}this.onSymbolAdded(o,e.isUndo)}else if("SymbolModified"===t.method&&this.onSymbolModified){const e=t.params,o=Object.assign(new r,e.symbol);this.onSymbolModified(e.poid,o,e.isUndo)}else if("SymbolDeleted"===t.method&&this.onSymbolDeleted){const e=t.params;this.onSymbolDeleted(e.poid,e.isUndo)}else if("InkProcessed"===t.method&&this.onInkProcessed)this.onInkProcessed();else if("SpeechRecognized"===t.method&&this.onSpeechRecognized){const e=t.params;this.onSpeechRecognized(e.phrases)}else if("StpMessage"===t.method&&this.onStpMessage){const e=t.params;this.onStpMessage(e.message,e.level)}else console.log("Received message with no handler: "+t.method)}},t.StpSymbol=r,t.StpWebSocketsConnector=class{constructor(t){this.DEFAULT_TIMEOUT=30,this.connstring=t,this.socket=null}get isConnected(){return null!=this.socket&&this.socket.readyState===this.socket.OPEN}get isConnecting(){return null!=this.socket&&this.socket.readyState===this.socket.CONNECTING}get connState(){return this.socket?this.socket.readyState.toString():""}connect(t,e,o=this.DEFAULT_TIMEOUT){return a(this,void 0,void 0,(function*(){return new Promise(((n,i)=>a(this,void 0,void 0,(function*(){this.isConnected&&n(),this.serviceName=t,this.solvables=e,o<=0&&(o=this.DEFAULT_TIMEOUT);try{this.socket=yield this.promiseWithTimeout(o,this.tryConnect(this.connstring)),yield this.register(this.serviceName,this.solvables,this.timeout)}catch(t){return void i(new Error("Failed to connect: "+t.message))}this.socket.onmessage=t=>{this.onInform&&this.onInform(t.data)},this.socket.onerror=t=>{this.onError&&this.onError("Error connecting to STP. Check that the service is running and refresh page to retry")},this.socket.onclose=t=>a(this,void 0,void 0,(function*(){if(!this.isConnecting)try{yield this.connect(this.serviceName,this.solvables,this.timeout)}catch(t){this.onError&&this.onError("Lost connection to STP. Check that the service is running and refresh page to retry")}})),n()}))))}))}register(t,e,o=this.DEFAULT_TIMEOUT){if(!this.isConnected)throw new Error("Failed to register: connection is not open ("+this.connState+")");return this.promiseWithTimeout(o,new Promise(((o,n)=>a(this,void 0,void 0,(function*(){this.socket&&(this.name=t,this.socket.send(JSON.stringify({method:"Register",params:{serviceName:this.name,language:"javascript",solvables:e,machineId:this.getUniqueId(9)}})),o())})))))}disconnect(t=this.DEFAULT_TIMEOUT){return this.promiseWithTimeout(t,new Promise(((t,e)=>a(this,void 0,void 0,(function*(){!this.isConnected&&this.socket&&this.socket.close(),t()})))))}inform(t,e=this.DEFAULT_TIMEOUT){if(!this.isConnected)throw new Error("Failed to send inform: connection is not open ("+this.connState+")");return this.promiseWithTimeout(e,new Promise(((e,o)=>a(this,void 0,void 0,(function*(){this.socket&&(this.socket.send(t),e())})))))}request(t,e=this.DEFAULT_TIMEOUT){throw new Error("Method not implemented")}tryConnect(t){return new Promise(((e,o)=>{var n=new WebSocket(t);n.onopen=()=>e(n),n.onerror=t=>o(new Error("Unspecified error communicating with STP"))}))}promiseWithTimeout(t,e){return Promise.race([e,new Promise(((e,o)=>{let n=setTimeout((()=>{clearTimeout(n),o(new Error("Operation timed out"))}),1e3*t)}))])}getUniqueId(t){return t||(t=9),Math.random().toString(36).substr(2,t)}},Object.defineProperty(t,"__esModule",{value:!0})}(e)})),s=n((function(t,e){(function(t,e){class o{constructor(){this.results=[],this.startTime=new Date,this.endTime=new Date}}class n{constructor(t,e){this.text=t,this.confidence=e}}class i{constructor(){this.RecognitionStatus="",this.Offset=0,this.Duration=0,this.DisplayText="",this.NBest=[]}}t.AzureSpeechRecognizer=class{constructor(t,o,n,i){this.speechSubscriptionKey=t,this.serviceRegion=o,this.speechConfig=e.SpeechConfig.fromSubscription(this.speechSubscriptionKey,this.serviceRegion),this.speechConfig.outputFormat=e.OutputFormat.Detailed,n&&(this.speechConfig.endpointId=n),this.audioConfig=i||e.AudioConfig.fromDefaultMicrophoneInput()}recognizeOnce(t){return t||(t=8),this.recognizer=new e.SpeechRecognizer(this.speechConfig,this.audioConfig),new Promise(((e,o)=>function(t,e,o,n){return new(o||(o=Promise))((function(i,s){function r(t){try{a(n.next(t))}catch(t){s(t)}}function l(t){try{a(n.throw(t))}catch(t){s(t)}}function a(t){var e;t.done?i(t.value):(e=t.value,e instanceof o?e:new o((function(t){t(e)}))).then(r,l)}a((n=n.apply(t,e||[])).next())}))}(this,void 0,void 0,(function*(){var n;for(let o=0;o<t;o++){this.recoStart=new Date;try{const t=yield this.tryReco(this.recoStart);return void e(t)}catch(t){}o<t-1&&(yield new Promise((t=>setTimeout(t,250))))}let i=new Error("Failed to recognize speech");null===(n=this.onError)||void 0===n||n.call(this,i),o(i)}))))}tryReco(t){return new Promise(((o,n)=>{var i;this.recognizer.recognizing=(t,e)=>{var o;null===(o=this.onRecognizing)||void 0===o||o.call(this,e.result.text)},this.recognizer.recognized=(e,n)=>{var i;let s=this.convertResults(t,n.result);null===(i=this.onRecognized)||void 0===i||i.call(this,s),o(s)},this.recognizer.canceled=(t,o)=>{n(new Error(e.CancellationReason[o.reason]))},null===(i=this.recognizer)||void 0===i||i.recognizeOnceAsync()}))}startRecognizing(){this.recognizer=new e.SpeechRecognizer(this.speechConfig,this.audioConfig),this.recoStart=new Date,this.recognizer.recognizing=(t,e)=>{var o;null===(o=this.onRecognizing)||void 0===o||o.call(this,e.result.text)},this.recognizer.recognized=(t,e)=>{var o;let n=this.convertResults(this.recoStart,e.result);null===(o=this.onRecognized)||void 0===o||o.call(this,n)},this.recognizer.canceled=(t,o)=>{var n;let i=new Error(e.CancellationReason[o.reason]);this.onError?this.onError.call(this,i):null===(n=this.onRecognized)||void 0===n||n.call(this,null)},this.recognizer.startContinuousRecognitionAsync()}stopRecognizing(t){this.recognizer&&setTimeout((()=>{var t;null===(t=this.recognizer)||void 0===t||t.close(),this.recognizer=void 0}),t||0)}convertResults(t,s){if(s.reason===e.ResultReason.NoMatch)return null;let r=new o;r.startTime=this.addTicksToDate(t,s.offset),r.endTime=this.addTicksToDate(r.startTime,s.duration);let l=s.properties.getProperty(e.PropertyId.SpeechServiceResponse_JsonResult);const a=Object.assign(new i,JSON.parse(l)).NBest.map((t=>new n(t.Lexical,t.Confidence)));let c=Array.from(a);for(let t=0;t<a.length;t++){const e=a[t];if(e.text.search(/^([a-zA-Z]\s)+[a-zA-Z]$/)>=0){const t=e.text.replace(/\s/g,""),o=.9*e.confidence;c.push(new n(t,o))}else if(e.text.search(/^([a-zA-Z]\s)+[a-zA-Z]+$/)>=0){let t=e.text.match(/^(([a-zA-Z]\s)+)([a-zA-Z]+)$/);if(t&&4==t.length){const o=t[1].replace(/\s/g,""),i=t[3],s=.7*e.confidence;c.push(new n(o+" "+i,s))}}}return r.results=c.sort(((t,e)=>e.confidence-t.confidence)),r}addTicksToDate(t,e){let o=1e4*t.getTime()+621355968e9;return new Date((o+e-621355968e9)/1e4)}},Object.defineProperty(t,"__esModule",{value:!0})})(e,o.default)}));class r{constructor(t,e=50){this.symbol=t,this.size=e}asGeoJSON(){let t=this.symbol.asGeoJSON(),e=this.getGestureGeometry(this.symbol);t.geometry=e;let o=this.asSVG();return o&&(t.properties.rendering=o),t}asSVG(){var t;if("point"==(null===(t=this.symbol.location)||void 0===t?void 0:t.fsTYPE)){return[this.pointSVG(this.symbol)]}return null}getGestureGeometry(t){var e,o,n,s,r,l,a;if(null==t.location||null==t.location||null==t.location.coords||0==t.location.coords.length||null==t.location.centroid)throw new Error("Symbol does not have location information");let c;if("point"==t.location.shape)c={type:"Point",coordinates:[t.location.centroid.lon,t.location.centroid.lat]};else if(c=this.toLineString(t.location.coords),null!=(null===(e=t.location)||void 0===e?void 0:e.shape)&&(null===(o=t.location)||void 0===o?void 0:o.shape.includes("arrowfat"))){let e=t.location.coords.slice(0,t.location.coords.length-1).reverse();e.push(t.location.coords[t.location.coords.length-1]),c=this.toLineString(e)}else if("ubend"==(null===(n=t.location)||void 0===n?void 0:n.shape)){let e=[t.location.coords[0],t.location.coords[2],t.location.coords[3],t.location.coords[1]];c=this.toLineString(e)}else if("ubendthreepoints"==(null===(s=t.location)||void 0===s?void 0:s.shape)){let e=new i.LatLon(t.location.coords[1].lat,t.location.coords[2].lon),o=[t.location.coords[0],t.location.coords[2],e,t.location.coords[1]];c=this.toLineString(o)}else if("vee"==(null===(r=t.location)||void 0===r?void 0:r.shape)){let e=[t.location.coords[1],t.location.coords[0],t.location.coords[2]];c=this.toLineString(e)}else"opencircle"==(null===(l=t.location)||void 0===l?void 0:l.shape)||"multipoint"==(null===(a=t.location)||void 0===a?void 0:a.shape)&&(c={type:"MultiPoint",coordinates:t.location.coords.map((t=>[t.lon,t.lat]))});return c}pointSVG(t){if(null==t.location||null==t.location||null==t.location.centroid)throw new Error("Point symbol does not have a defined centroid");let e,o,n,i,s,r=0,l="";const a=1.42;if("friend"===t.affiliation)i=this.size-2,s=this.size/a-2,e="rect",o='width="'+i+'" height="'+s+'" ',n="#80e0ff";else if("hostile"===t.affiliation){let t=this.size/a-2;i=s=t*Math.SQRT2,e="rect",o='width="'+t+'" height="'+t+'" ',n="#ff8080",r=45,l='transform="translate('+i/2+" 0) rotate("+r+')" '}else"neutral"===t.affiliation?(i=s=this.size/a-2,e="rect",o='width="'+i+'" height="'+s+'" ',n="#aaffaa"):(i=s=this.size/a-2,e="circle",o='cx="'+i/2+'" cy="'+s/2+'" r="'+i/2+'" ',n="#ffff80");let c,d='<svg xmlns="http://www.w3.org/2000/svg" version="1.2" baseProfile="tiny" width="'+i+'" height="'+s+'" viewBox="0 0 '+i+" "+s+'" > <'+e+" "+o+' stroke="black" stoke-width="1" fill="'+n+'" '+l+"/></svg>";if(r>0){const t=this.getTransform(d,e);c=[this.applyTransform(t,{x:0,y:0}),this.applyTransform(t,{x:i,y:0}),this.applyTransform(t,{x:i,y:s}),this.applyTransform(t,{x:0,y:s})]}else c=[{x:0,y:0},{x:i,y:0},{x:i,y:s},{x:0,y:s}];return{type:"icon",title:t.description,topLeft:t.location.centroid,bottomRight:t.location.centroid,position:t.location.centroid,svg:btoa(d),shape:c,anchor:{x:i/2,y:s/2}}}getTransform(t,e){let o=document.createElement("div");document.body.appendChild(o),o.setAttribute("style","position:absolute; padding:0; margin:0;visibility:hidden; width:0; height:0"),o.insertAdjacentHTML("beforeend",t);let n=o.querySelector(e),i=null==n?void 0:n.getCTM();return document.body.removeChild(o),i?[i.a,i.b,i.c,i.d,i.e,i.f]:[1,0,0,1,0,0]}toLineString(t){return{type:"LineString",coordinates:t.map((t=>[t.lon,t.lat]))}}applyTransform(t,e){return{x:e.x*t[0]+e.y*t[2]+t[4],y:e.x*t[1]+e.y*t[3]+t[5]}}}var l=function(t,e,o,n){return new(o||(o=Promise))((function(i,s){function r(t){try{a(n.next(t))}catch(t){s(t)}}function l(t){try{a(n.throw(t))}catch(t){s(t)}}function a(t){var e;t.done?i(t.value):(e=t.value,e instanceof o?e:new o((function(t){t(e)}))).then(r,l)}a((n=n.apply(t,e||[])).next())}))};class a{constructor(t,e,o,n){this.apiKey=t,this.mapDivId=e,this.mapCenter=o,this.zoomLevel=n,this.strokeStart=this.strokeEnd="",this.assets=new Map}load(){return l(this,void 0,void 0,(function*(){const t="https://maps.googleapis.com/maps/api/js?key="+this.apiKey;document.querySelectorAll('[src="'+t+'"]').length?yield this.initMap():document.body.appendChild(Object.assign(document.createElement("script"),{type:"text/javascript",src:t,onload:()=>l(this,void 0,void 0,(function*(){return yield this.initMap()}))}))}))}initMap(){return l(this,void 0,void 0,(function*(){const t=document.getElementById(this.mapDivId);if(!t)throw new Error("Html page must contain a 'map' div");this.map=new google.maps.Map(t,{zoom:this.zoomLevel,center:{lat:this.mapCenter.lat,lng:this.mapCenter.lon},gestureHandling:"cooperative",draggable:!0,draggableCursor:"crosshair"}),this.map.data.setStyle((t=>{let e=t.getProperty("rendering");if(e){for(let o=0;o<e.length;o++){let n=e[o].shape.map((t=>[t.x,t.y])).flat(),i=new google.maps.Marker({map:this.map,icon:{url:"data:image/svg+xml;charset=UTF-8;base64,"+e[o].svg,anchor:new google.maps.Point(e[o].anchor.x,e[o].anchor.y)},shape:{type:"poly",coords:n},position:{lat:e[o].position.lat,lng:e[o].position.lon}});e[o].title&&i.setTitle(e[o].title),i.addListener("click",(()=>{var e;null===(e=this.onSelection)||void 0===e||e.call(this,t.getProperty("symbol"))}));let s=t.getProperty("symbol").poid;this.assets.has(s)?this.assets.get(s).push(i):this.assets.set(s,[i])}return{visible:"Point"!=t.getGeometry().getType()}}return{visible:!0}})),this.map.data.addListener("click",(t=>{var e;null===(e=this.onSelection)||void 0===e||e.call(this,t.feature.getProperty("symbol"))})),this.map.addListener("mousedown",(t=>{var e;if(t.domEvent.ctrlKey)return!1;t.domEvent.preventDefault(),this.enableDrawing(),null===(e=this.onStrokeStart)||void 0===e||e.call(this,new i.LatLon(t.latLng.lat(),t.latLng.lng()),this.getIsoTimestamp()),this.drawFreeHand(t.latLng)}))}))}drawFreeHand(t){this.strokeStart=this.getIsoTimestamp(),this.clearInk(),this.strokePoly=new google.maps.Polyline({map:this.map,clickable:!1,strokeColor:"#8B0000",strokeWeight:2}),this.strokePoly.getPath().push(t),this.moveListener=google.maps.event.addListener(this.map,"mousemove",(t=>{this.strokePoly.getPath().push(t.latLng)})),google.maps.event.addListenerOnce(this.map,"mouseup",(t=>{this.strokeEnd=this.getIsoTimestamp(),this.moveListener&&google.maps.event.removeListener(this.moveListener),this.enableDragZoom();let e=this.strokePoly.getPath();1==e.getLength()&&e.push(e.getAt(0));let o=e.getArray().map((t=>new i.LatLon(t.lat(),t.lng()))),n={width:document.getElementById("map").clientWidth,height:document.getElementById("map").clientHeight},s=this.map.getBounds();if(!s)throw new Error("Failed to retrieve the map bounds - unable to send ink to STP");this.onStrokeCompleted&&this.onStrokeCompleted(new i.Size(n.width,n.height),new i.LatLon(s.getNorthEast().lat(),s.getSouthWest().lng()),new i.LatLon(s.getSouthWest().lat(),s.getNorthEast().lng()),o,this.strokeStart,this.strokeEnd,[])}))}enableDrawing(){this.map.setOptions({draggable:!1,zoomControl:!1,scrollwheel:!1,disableDoubleClickZoom:!1})}enableDragZoom(){this.map.setOptions({draggable:!0,zoomControl:!0,scrollwheel:!0,disableDoubleClickZoom:!0})}addFeature(t){t&&this.map.data.addGeoJson(t)}removeFeature(t){let e=this.map.data.getFeatureById(t);if(e){if(this.assets.has(t)){let e=this.assets.get(t);for(let t=0;t<e.length;t++)e[t].setMap(null)}this.map.data.remove(e)}}displayInfo(t,e,o){let n=document.createElement("div");n.innerHTML=t;let i={lat:e.lat,lng:e.lon},s=new google.maps.InfoWindow({content:n,position:i});if(s&&o&&o.length)for(let t=0;t<o.length;t++){let e=n.querySelector(o[t].selector);e&&o[t].handler&&google.maps.event.addDomListener(e,"click",(e=>{o[t].closeInfo&&s.close(),o[t].handler(e)}))}s.open(this.map)}clearInk(){var t;null===(t=this.strokePoly)||void 0===t||t.setMap(null)}getBounds(){return this.map.getBounds()}getIsoTimestamp(){return(new Date).toISOString()}}var c=function(t,e,o,n){return new(o||(o=Promise))((function(i,s){function r(t){try{a(n.next(t))}catch(t){s(t)}}function l(t){try{a(n.throw(t))}catch(t){s(t)}}function a(t){var e;t.done?i(t.value):(e=t.value,e instanceof o?e:new o((function(t){t(e)}))).then(r,l)}a((n=n.apply(t,e||[])).next())}))};let d,h,u="<Enter your Azure Speech subscription key here>",p="<Enter Azure's subscription region>",m=null,g="<Enter your Google Maps API key here>",f=new i.LatLon(58.967774948,11.196062412),v=13,y="ws://<STP server>:<STP port>";function S(t,e,o){o&&alert(t);let n=document.getElementById("messages");if(!n)throw new Error("Html page must contain a 'messages' div");n.innerHTML=t,n.style.color="Error"===e?"red":"black"}window.onload=()=>function(){return c(this,void 0,void 0,(function*(){const t=new URLSearchParams(window.location.search),e=t.get("mapkey");e&&(g=e);const o=t.get("lat"),n=t.get("lon");o&&n&&(f=new i.LatLon(parseFloat(o),parseFloat(n)));const l=t.get("zoom");l&&(v=parseInt(l));const w=t.get("azkey");w&&(u=w);const b=t.get("azregion");b&&(p=b),t.get("azlang");const T=t.get("azendp");T&&(m=T);const E=t.get("stpurl");E&&(y=E);const k=new i.StpWebSocketsConnector(y);d=new i.StpRecognizer(k),d.onSymbolAdded=(t,e)=>{let o=new r(t[0]).asGeoJSON();h.addFeature(o)},d.onSymbolModified=(t,e,o)=>{h.removeFeature(t);let n=new r(e).asGeoJSON();h.addFeature(n)},d.onSymbolDeleted=(t,e)=>{h.removeFeature(t)},d.onInkProcessed=()=>{h.clearInk()},d.onSpeechRecognized=t=>{let e="";t&&t.length>0&&(e=t[0]),S(e)},d.onStpMessage=(t,e)=>{S(t,e,!0)};try{yield d.connect("GoogleMapsSample",10)}catch(t){return void S("Failed to connect to STP at "+y+". \nSymbols will not be recognized. Please reload to try again",i.StpMessageLevel.Error,!0)}h=new a(g,"map",f,v),h.onStrokeStart=(t,e)=>{d.sendPenDown(t,e),function(){c(this,void 0,void 0,(function*(){try{const t=new s.AzureSpeechRecognizer(u,p,m);let e=yield t.recognizeOnce();e&&(d.sendSpeechRecognition(e.results,e.startTime,e.endTime),e.results&&e.results.length>0&&S(e.results[0].text))}catch(t){S("Failed to process speech: "+t.message)}}))}()},h.onStrokeCompleted=(t,e,o,n,i,s,r)=>{d.sendInk(t,e,o,n,i,s,r)},h.onSelection=t=>{let e=function(t){var e,o,n,i;if(!t||!t.location||!t.location.centroid)return null;let s='<h3 id="firstHeading" class="firstHeading">'+t.fullDescription+"</h3><table><tr><td>2525D PartA</td><td>"+(null===(e=t.sidc)||void 0===e?void 0:e.partA)+"</td></tr><tr><td>2525D PartB</td><td>"+(null===(o=t.sidc)||void 0===o?void 0:o.partB)+"</td></tr><tr><td>Symbol Set</td><td>"+(null===(n=t.sidc)||void 0===n?void 0:n.symbolSet)+"</td></tr><tr><td>2525C SIDC</td><td>"+(null===(i=t.sidc)||void 0===i?void 0:i.legacy)+"</td></tr><tr><td>Affiliation</td><td>"+t.affiliation+"</td></tr>";"unit"==t.fsTYPE&&(s+="<tr><td>Echelon</td><td>"+t.echelon+"</td></tr>");s+="<tr><td>Parent Unit</td><td>"+t.parent+"</td></tr><tr><td>Designator 1</td><td>"+t.designator1+"</td></tr><tr><td>Designator 2</td><td>"+t.designator2+"</td></tr><tr><td>Status</td><td>"+t.status+"</td></tr>","unit"==t.fsTYPE&&(s+="<tr><td>Modifier</td><td>"+t.modifier+"</td></tr><tr><td>Strength</td><td>"+t.strength+"</td></tr>");return s+="<tr><td>Time From</td><td>"+t.timeFrom+"</td></tr><tr><td>Time To</td><td>"+t.timeTo+"</td></tr><tr><td>Altitude</td><td>"+t.altitude+"</td></tr><tr><td>Min Altitude</td><td>"+t.minAltitude+"</td></tr><tr><td>Max Altitude</td><td>"+t.maxAltitude+'</td></tr><tr><td><button id="delButton">Delete</button></td></tr></table>',s}(t);e&&t&&t.poid&&t.location&&t.location.centroid&&h.displayInfo(e,t.location.centroid,[{selector:"#delButton",handler:e=>{d.deleteSymbol(t.poid)},closeInfo:!0}])},h.load()}))}()}();