var e,t;e=this,t=function(e){class t{constructor(e,t,o,s){this.strokeStart="",this.strokeEnd="",this.assets=new Map,this.load=async()=>{new google.maps.plugins.loader.Loader({apiKey:this.apiKey,version:"weekly"}).loadCallback(async e=>{if(e)throw console.log(e),new Error(e);await this.initMap()})},this.initMap=async()=>{const e=document.getElementById(this.mapDivId);if(!e)throw new Error("Html page must contain a '#map' div");this.mapRef=new google.maps.Map(e,{mapTypeId:google.maps.MapTypeId.TERRAIN,zoom:this.zoomLevel,center:{lat:this.mapCenter.lat,lng:this.mapCenter.lon},gestureHandling:"cooperative",draggable:!0,draggableCursor:"crosshair"}),this.mapRef.setOptions({styles:[{featureType:"administrative",elementType:"geometry",stylers:[{visibility:"off"}]},{featureType:"poi",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"transit",stylers:[{visibility:"off"}]}]}),this.mapRef.data.setStyle(e=>{const t=e.getProperty("rendering");if(t){for(let o=0;o<t.length;o++){const s=t[o].shape.map(e=>[e.x,e.y]).flat(),a=new google.maps.Marker({map:this.mapRef,icon:{url:"data:image/svg+xml;charset=UTF-8;base64,"+t[o].svg,anchor:new google.maps.Point(t[o].anchor.x,t[o].anchor.y)},shape:{type:"poly",coords:s},cursor:"crosshair",position:{lat:t[o].position.lat,lng:t[o].position.lon}});t[o].title&&a.setTitle(t[o].title),a.addListener("rightclick",()=>{var t;null===(t=this.onSelection)||void 0===t||t.call(this,e.getProperty("symbol"))}),a.addListener("mousedown",e=>{var t;e&&e.domEvent&&0===e.domEvent.button&&(e.domEvent.preventDefault(),this.enableDrawing(),null===(t=this.onStrokeStart)||void 0===t||t.call(this,{lat:e.latLng.lat(),lon:e.latLng.lng()},this.getIsoTimestamp()),this.drawFreeHand(e.latLng))});const i=e.getProperty("symbol").poid;this.assets.has(i)?this.assets.get(i).push(a):this.assets.set(i,[a])}return{visible:"Point"!=e.getGeometry().getType(),cursor:"crosshair"}}return{visible:!0,cursor:"crosshair"}}),this.mapRef.data.addListener("mousedown",e=>{var t,o;if(e&&e.domEvent){const s=e.domEvent.button;2===s?null===(t=this.onSelection)||void 0===t||t.call(this,e.feature.getProperty("symbol")):0===s&&(e.domEvent.preventDefault(),this.enableDrawing(),null===(o=this.onStrokeStart)||void 0===o||o.call(this,{lat:e.latLng.lat(),lon:e.latLng.lng()},this.getIsoTimestamp()),this.drawFreeHand(e.latLng))}}),this.mapRef.addListener("mousedown",e=>{var t;if(!e||!e.domEvent||0===e.domEvent.button){if(e.domEvent&&e.domEvent.ctrlKey)return!1;e.domEvent&&e.domEvent.preventDefault(),this.enableDrawing(),null===(t=this.onStrokeStart)||void 0===t||t.call(this,{lat:e.latLng.lat(),lon:e.latLng.lng()},this.getIsoTimestamp()),this.drawFreeHand(e.latLng)}})},this.drawFreeHand=e=>{this.strokeStart=this.getIsoTimestamp(),this.clearInk(),this.strokePoly=new google.maps.Polyline({map:this.mapRef,clickable:!1,strokeColor:"#8B0000",strokeWeight:2}),this.strokePoly.getPath().push(e),this.moveListener=google.maps.event.addListener(this.mapRef,"mousemove",e=>{this.strokePoly.getPath().push(e.latLng)});let t=!1;const o=()=>{var e;if(t)return;t=!0,this.strokeEnd=this.getIsoTimestamp(),this.moveListener&&(google.maps.event.removeListener(this.moveListener),this.moveListener=void 0),this.enableDragZoom();const o=this.strokePoly.getPath();1==o.getLength()&&o.push(o.getAt(0));const s=o.getArray().map(e=>({lat:e.lat(),lon:e.lng()})),a={width:document.getElementById("map").clientWidth,height:document.getElementById("map").clientHeight},i=this.mapRef.getBounds();if(!i)throw new Error("Failed to retrieve the map bounds - unable to send ink to STP");null===(e=this.onStrokeCompleted)||void 0===e||e.call(this,{width:a.width,height:a.height},{lat:i.getNorthEast().lat(),lon:i.getSouthWest().lng()},{lat:i.getSouthWest().lat(),lon:i.getNorthEast().lng()},s,this.strokeStart,this.strokeEnd,[])};google.maps.event.addListenerOnce(this.mapRef,"mouseup",o),document.addEventListener("mouseup",o,{once:!0})},this.enableDrawing=()=>{this.mapRef.setOptions({draggable:!1,zoomControl:!1,scrollwheel:!1,disableDoubleClickZoom:!1})},this.enableDragZoom=()=>{this.mapRef.setOptions({draggable:!0,zoomControl:!0,scrollwheel:!0,disableDoubleClickZoom:!0})},this.addFeature=e=>{e&&this.mapRef.data.addGeoJson(e)},this.removeFeature=e=>{var t;const o=null===(t=this.mapRef)||void 0===t?void 0:t.data.getFeatureById(e);if(o){if(this.assets.has(e)){const t=this.assets.get(e);for(let e=0;e<t.length;e++)t[e].setMap(null)}this.mapRef.data.remove(o)}},this.addPoly=(e,t="#66cc00",o=2)=>{e&&0!==e.length&&(1===e.length&&(e.push(e[0]),o*=2),new google.maps.Polyline({map:this.mapRef,path:e.map(e=>({lat:e.lat,lng:e.lon})),clickable:!1,strokeColor:t,strokeWeight:o}))},this.getBounds=()=>this.mapRef.getBounds(),this.displayInfo=(e,t,o)=>{const s=document.createElement("div");s.innerHTML=e;const a={lat:t.lat,lng:t.lon},i=new google.maps.InfoWindow({content:s,position:a});if(i&&o&&o.length)for(let e=0;e<o.length;e++){const t=s.querySelector(o[e].selector);t&&o[e].handler&&google.maps.event.addDomListener(t,"click",t=>{o[e].closeInfo&&i.close(),o[e].handler(t)})}i.open(this.mapRef)},this.clearInk=()=>{var e;null===(e=this.strokePoly)||void 0===e||e.setMap(null)},this.getIsoTimestamp=()=>(new Date).toISOString(),this.apiKey=e,this.mapDivId=t,this.mapCenter=o,this.zoomLevel=s}}window.GoogleMap=t,e.GoogleMap=t},"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).GoogleMap={});