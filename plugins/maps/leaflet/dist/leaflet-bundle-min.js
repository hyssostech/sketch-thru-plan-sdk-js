var t,e;t=this,e=function(t){class e{constructor(t,e,o,i){this.strokeStart="",this.strokeEnd="",this.assets=new Map,this.load=async()=>{const t=document.getElementById(this.mapDivId);if(!t)throw new Error("Html page must contain a '#map' div");this.mapRef=L.map(t,{center:[this.mapCenter.lat,this.mapCenter.lon],zoom:this.zoomLevel,zoomControl:!0}),this.mapRef.getContainer().style.cursor="crosshair";const e=document.createElement("style");e.textContent=".leaflet-container, .leaflet-interactive { cursor: crosshair !important; }",document.head.appendChild(e),L.tileLayer("https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png",{maxZoom:17,attribution:"Map data: © OpenStreetMap contributors, SRTM | Map style: © OpenTopoMap"}).addTo(this.mapRef),this.mapRef.on("mousedown",t=>{var e;if(t.originalEvent&&0!==t.originalEvent.button)return;if(t.originalEvent&&t.originalEvent.ctrlKey)return;t.originalEvent&&t.originalEvent.preventDefault(),this.enableDrawing();const o=t.latlng;null===(e=this.onStrokeStart)||void 0===e||e.call(this,{lat:o.lat,lon:o.lng},this.getIsoTimestamp()),this.drawFreeHand(o)})},this.drawFreeHand=t=>{this.strokeStart=this.getIsoTimestamp(),this.clearInk(),this.strokePoly=L.polyline([],{color:"#8B0000",weight:2,interactive:!1}).addTo(this.mapRef),this.strokePoly.addLatLng(t);const e=t=>{this.strokePoly.addLatLng(t.latlng)};this.moveListener=e,this.mapRef.on("mousemove",e);let o=!1;const i=()=>{var t;if(o)return;o=!0,this.strokeEnd=this.getIsoTimestamp(),this.moveListener&&(this.mapRef.off("mousemove",this.moveListener),this.moveListener=void 0),this.enableDragZoom();const e=this.strokePoly.getLatLngs();1===e.length&&e.push(e[0]);const i=e.map(t=>({lat:t.lat,lon:t.lng})),s=document.getElementById(this.mapDivId),n={width:s.clientWidth,height:s.clientHeight},a=this.mapRef.getBounds(),r=a.getNorthEast(),l=a.getSouthWest();null===(t=this.onStrokeCompleted)||void 0===t||t.call(this,{width:n.width,height:n.height},{lat:r.lat,lon:l.lng},{lat:l.lat,lon:r.lng},i,this.strokeStart,this.strokeEnd,[])};this.mapRef.once("mouseup",i),document.addEventListener("mouseup",i,{once:!0})},this.enableDrawing=()=>{this.mapRef.dragging.disable(),this.mapRef.scrollWheelZoom.disable(),this.mapRef.doubleClickZoom.disable(),this.mapRef.getContainer().style.cursor="crosshair"},this.enableDragZoom=()=>{this.mapRef.dragging.enable(),this.mapRef.scrollWheelZoom.enable(),this.mapRef.doubleClickZoom.enable(),this.mapRef.getContainer().style.cursor="crosshair"},this.addFeature=t=>{var e,o;if(!t)return;const i=(null===(o=null===(e=null==t?void 0:t.properties)||void 0===e?void 0:e.symbol)||void 0===o?void 0:o.poid)||(null==t?void 0:t.poid),s=L.geoJSON(t,{style:()=>({color:"#000",weight:2,interactive:!0,pane:"overlayPane"}),onEachFeature:(t,e)=>{e.on("contextmenu",()=>{var e;return null===(e=this.onSelection)||void 0===e?void 0:e.call(this,t.properties.symbol)})},pointToLayer:(t,e)=>{const o=t.properties&&t.properties.rendering;if(o&&o.length){const e=o[0],i=L.icon({iconUrl:"data:image/svg+xml;charset=UTF-8;base64,"+e.svg,iconAnchor:[e.anchor.x,e.anchor.y]}),s=L.marker([e.position.lat,e.position.lon],{icon:i,interactive:!0});return e.title&&s.bindTooltip(e.title,{permanent:!1}),s.on("contextmenu",()=>{var e;return null===(e=this.onSelection)||void 0===e?void 0:e.call(this,t.properties.symbol)}),s}return L.circleMarker(e,{radius:6,color:"#000"})}}).addTo(this.mapRef);if(i){const t=this.assets.get(i)||[];t.push(s),this.assets.set(i,t)}},this.removeFeature=t=>{if(!t)return;const e=this.assets.get(t);e&&(e.forEach(t=>this.mapRef.removeLayer(t)),this.assets.delete(t))},this.addPoly=(t,e="#66cc00",o=2)=>{if(!t||0===t.length)return;const i=t.map(t=>[t.lat,t.lon]);L.polyline(i,{color:e,weight:o,interactive:!1}).addTo(this.mapRef)},this.getBounds=()=>this.mapRef.getBounds(),this.displayInfo=(t,e,o)=>{const i=document.createElement("div");i.innerHTML=t;const s=L.popup({closeOnClick:!0}).setLatLng([e.lat,e.lon]).setContent(i).openOn(this.mapRef);if(s&&o&&o.length)for(let t=0;t<o.length;t++){const e=i.querySelector(o[t].selector);e&&o[t].handler&&e.addEventListener("click",e=>{o[t].closeInfo&&this.mapRef.closePopup(s),o[t].handler(e)})}},this.clearInk=()=>{this.strokePoly&&(this.mapRef.removeLayer(this.strokePoly),this.strokePoly=void 0)},this.getIsoTimestamp=()=>(new Date).toISOString(),this.apiKey=t,this.mapDivId=e,this.mapCenter=o,this.zoomLevel=i}}window.LeafletMap=e,t.LeafletMap=e},"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).LeafletMap={});