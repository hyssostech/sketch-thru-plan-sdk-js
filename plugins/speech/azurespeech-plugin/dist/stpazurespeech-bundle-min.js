var e,t;e=this,t=function(e,t){var n=function(e,t,n,s){return new(n||(n=Promise))((function(o,i){function r(e){try{a(s.next(e))}catch(e){i(e)}}function c(e){try{a(s.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,c)}a((s=s.apply(e,t||[])).next())}))};class s{constructor(){this.results=[],this.startTime=new Date,this.endTime=new Date}}class o{constructor(e,t){this.text=e,this.confidence=t}}class i{constructor(){this.RecognitionStatus="",this.Offset=0,this.Duration=0,this.DisplayText="",this.NBest=[]}}e.AzureSpeechRecognizer=class{constructor(e,n,s,o){this.speechSubscriptionKey=e,this.serviceRegion=n;const i=t.SpeechConfig.fromSubscription(this.speechSubscriptionKey,this.serviceRegion);i.outputFormat=t.OutputFormat.Detailed,s&&(i.endpointId=s),this.audioConfig=o||t.AudioConfig.fromDefaultMicrophoneInput(),this.recognizer=new t.SpeechRecognizer(i,this.audioConfig)}recognize(e){return e||(e=8),new Promise(((t,s)=>n(this,void 0,void 0,(function*(){for(let n=0;n<e;n++){const s=new Date;try{const e=yield this.recoOnce(s);return void t(e)}catch(e){}n<e-1&&(yield new Promise((e=>setTimeout(e,250))))}s(new Error("Failed to recognize speech"))}))))}recoOnce(e){return new Promise(((n,r)=>{this.recognizer.recognizeOnceAsync((c=>{switch(c.reason){case t.ResultReason.RecognizedSpeech:let u=new s;u.startTime=this.addTicksToDate(e,c.offset),u.endTime=this.addTicksToDate(u.startTime,c.duration);let h=c.properties.getProperty(t.PropertyId.SpeechServiceResponse_JsonResult);const l=Object.assign(new i,JSON.parse(h)).NBest.map((e=>new o(e.Lexical,e.Confidence)));u.results=Array.from(l);for(let e=0;e<l.length;e++){const t=l[e];if(t.text.search(/^([a-zA-Z]\s)+[a-zA-Z]$/)>=0){const e=t.text.replace(/\s/g,""),n=.9*t.confidence;u.results.push(new o(e,n))}}n(u);break;case t.ResultReason.NoMatch:n(null);break;case t.ResultReason.Canceled:var a=t.CancellationDetails.fromResult(c);r(new Error(t.CancellationReason[a.reason]))}}),(e=>{r(new Error(e))}))}))}addTicksToDate(e,t){let n=1e4*e.getTime()+621355968e9;return new Date((n+t-621355968e9)/1e4)}},Object.defineProperty(e,"__esModule",{value:!0})},"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("microsoft-cognitiveservices-speech-sdk")):"function"==typeof define&&define.amd?define(["exports","microsoft-cognitiveservices-speech-sdk"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).StpAS={},e.SpeechSDK);