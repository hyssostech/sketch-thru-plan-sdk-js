var e,t;e=this,t=function(e,t){function i(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(i){if("default"!==i){var s=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(t,i,s.get?s:{enumerable:!0,get:function(){return e[i]}})}})),t.default=e,Object.freeze(t)}var s=i(t);class n{constructor(){this.results=[],this.startTime=new Date,this.endTime=new Date}}class r{constructor(e,t){this.text=e,this.confidence=t}}class o{constructor(){this.RecognitionStatus="",this.Offset=0,this.Duration=0,this.DisplayText="",this.NBest=[]}}e.AzureSpeechRecognizer=class{constructor(e,t,i,n,r){this.speechSubscriptionKey=e,this.serviceRegion=t,this.speechConfig=s.SpeechConfig.fromSubscription(this.speechSubscriptionKey,this.serviceRegion),this.speechConfig.speechRecognitionLanguage=r||"en-US",this.speechConfig.outputFormat=s.OutputFormat.Detailed,i&&(this.speechConfig.endpointId=i),this.audioConfig=n||s.AudioConfig.fromDefaultMicrophoneInput(),this.isListening=!1}setPhraseList(e){this.phraseList=e}initializeReco(){this.recognizer=new s.SpeechRecognizer(this.speechConfig,this.audioConfig),this.phraseList&&s.PhraseListGrammar.fromRecognizer(this.recognizer).addPhrases(this.phraseList)}recognizeOnce(e){return e||(e=8),this.initializeReco(),new Promise((async(t,i)=>{for(let i=0;i<e;i++){this.recoStart=new Date;try{return void t(await this.tryReco(this.recoStart))}catch(e){}i<e-1&&await new Promise((e=>setTimeout(e,250)))}let s=new Error("Failed to recognize speech");this.onError?.call(this,s),i(s)}))}tryReco(e){return new Promise(((t,i)=>{this.recognizer.recognizing=(e,t)=>{this.onRecognizing?.call(this,t.result.text)},this.recognizer.recognized=(i,s)=>{let n=this.convertResults(e,s.result);this.onRecognized?.call(this,n),t(n)},this.recognizer.canceled=(e,t)=>{this.isListening=!1,i(new Error(s.CancellationReason[t.reason]))},this.isListening||(this.isListening=!0,this.recognizer?.recognizeOnceAsync(),this.isListening=!1)}))}startRecognizing(){this.isListening||(this.initializeReco(),this.recoStart=new Date,this.recognizer.recognizing=(e,t)=>{this.onRecognizing?.call(this,t.result.text)},this.recognizer.recognized=(e,t)=>{let i=this.convertResults(this.recoStart,t.result);this.onRecognized?.call(this,i)},this.recognizer.canceled=(e,t)=>{this.isListening=!1;let i=new Error(s.CancellationReason[t.reason]);this.onError?this.onError.call(this,i):this.onRecognized?.call(this,null)},this.isListening=!0,this.recognizer.startContinuousRecognitionAsync())}stopRecognizing(e){this.recognizer&&setTimeout((()=>{this.recognizer?.close(),this.recognizer=void 0}),e||0),this.isListening=!1}convertResults(e,t){if(t.reason===s.ResultReason.NoMatch)return null;let i=new n;i.startTime=this.addTicksToDate(e,t.offset),i.endTime=this.addTicksToDate(i.startTime,t.duration);let c=t.properties.getProperty(s.PropertyId.SpeechServiceResponse_JsonResult);const h=Object.assign(new o,JSON.parse(c)).NBest.map((e=>new r(e.Lexical,e.Confidence)));let a=Array.from(h);for(let e=0;e<h.length;e++){const t=h[e];if(t.text.search(/^([a-zA-Z]\s)+[a-zA-Z]$/)>=0){const e=t.text.replace(/\s/g,""),i=.9*t.confidence;a.push(new r(e,i))}else if(t.text.search(/^([a-zA-Z]\s)+[a-zA-Z][a-zA-Z]+$/)>=0){let e=t.text.match(/^(([a-zA-Z]\s)+)([a-zA-Z][a-zA-Z]+)$/);if(e&&4==e.length){const i=e[1].replace(/\s/g,""),s=e[3],n=.85*t.confidence;a.push(new r(i+" "+s,n))}}}return i.results=a.sort(((e,t)=>t.confidence-e.confidence)),i}addTicksToDate(e,t){let i=1e4*e.getTime()+621355968e9;return new Date((i+t-621355968e9)/1e4)}},Object.defineProperty(e,"__esModule",{value:!0})},"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("microsoft-cognitiveservices-speech-sdk")):"function"==typeof define&&define.amd?define(["exports","microsoft-cognitiveservices-speech-sdk"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).StpAS={},e.SpeechSDK);